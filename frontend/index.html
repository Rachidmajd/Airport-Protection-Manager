<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aeronautical Deconfliction & Analysis Platform</title>
    
    <!-- Third-party CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css" />
    
    <!-- Application CSS -->
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <!-- ===== APPLICATION SCREENS ===== -->

    <!-- Loading Screen -->
    <div id="loading-screen" class="screen loading-screen">
        <div class="loading-content">
            <div class="spinner"></div>
            <h2>Aeronautical Deconfliction Platform</h2>
            <p>Initializing secure aviation analysis system...</p>
        </div>
    </div>

    <!-- Login Screen -->
    <div id="login-screen" class="screen login-screen hidden">
        <div class="login-container">
            <div class="login-header">
                <h1>üõ©Ô∏è Aviation Platform</h1>
                <p>Secure access required for aeronautical operations</p>
            </div>
            <div class="login-content">
                <form id="login-form" class="login-form" novalidate>
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" id="username" name="username" required placeholder="Enter your username" autocomplete="username" autocapitalize="none" spellcheck="false">
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" name="password" required placeholder="Enter your password" autocomplete="current-password">
                    </div>
                    <div id="login-error" class="login-error hidden" role="alert"></div>
                    <button type="submit" id="login-btn" class="login-button">
                        <span id="login-btn-text">üîê Login</span>
                        <span id="login-spinner" class="login-spinner hidden">‚è≥ Logging in...</span>
                    </button>
                </form>
                <div class="login-footer">
                    <p><strong>Test credentials:</strong> testuser / oper</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application Screen -->
    <div id="app" class="screen app hidden">
        
        <!-- Main Header -->
        <header class="header">
            <div class="header-content">
                <div class="header-brand"><h1 class="header-title">üõ©Ô∏è</h1></div>
                <div class="header-project-area">
                    <div id="project-opener">
                        <button id="open-project-btn" class="button primary">Open Project</button>
                    </div>
                    <div id="project-display" class="hidden">
                        <div class="project-info">
                            <span class="project-label">Project:</span>
                            <span id="project-title-text" class="project-title-text"></span>
                        </div>
                        <div class="project-actions">
                            <div class="dropdown">
                                <button id="operations-dropdown-btn" class="button secondary dropdown-toggle">Operations ‚ñº</button>
                                <div id="operations-dropdown-menu" class="dropdown-menu hidden">
                                    <a href="#" id="edit-project-btn" class="dropdown-item">Edit Project</a>
                                    <a href="#" id="submit-project-btn" class="dropdown-item">Submit Project</a>
                                    <a href="#" id="report-project-btn" class="dropdown-item">Generate Report</a>
                                </div>
                            </div>
                            <button id="close-project-btn" class="button secondary danger">&times; Close</button>
                        </div>
                    </div>
                </div>
                <div class="header-actions">
                    <span id="user-info" class="user-info">Loading...</span>
                    <button id="logout-btn" class="logout-button">Logout</button>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <div class="main-content">
            <aside class="sidebar">
                <div class="panel">
                    <h2 class="panel-title">Flight Procedures</h2>
                    <div id="procedure-controls">
                        <div id="procedure-list" class="procedure-list"></div>
                    </div>
                </div>
                <div class="panel">
                    <h2 class="panel-title">
                        Project Tree
                        <span id="project-tree-count" class="conflict-count zero">0</span>
                    </h2>
                    <div id="project-tree" class="conflict-list">
                        <div class="no-project-tree"><p>üìÇ No active project</p></div>
                    </div>
                </div>
                <div class="panel">
                    <h2 class="panel-title">
                        Conflict Summary
                        <span id="conflict-count" class="conflict-count zero">0</span>
                    </h2>
                    <div id="conflict-list" class="conflict-list">
                        <div class="no-conflicts"><p>‚úÖ No conflicts detected</p></div>
                    </div>
                </div>

            </aside>
            <main class="map-container">
                <div id="map" class="map"></div>
                <div class="map-tools-container">
                    <div id="drawing-tools-panel" class="drawing-tools hidden">
                        <h3>Draw Drone Zone</h3>
                        <button id="draw-polygon-btn" class="tool-button"><span>üìê Polygon</span></button>
                        <button id="draw-circle-btn" class="tool-button"><span>‚≠ï Circle</span></button>
                        <button id="draw-point-btn" class="tool-button"><span>üìç Point</span></button> <!-- NEW -->
                        <button id="manual-entry-btn" class="tool-button"><span>‚å®Ô∏è Enter Coordinates</span></button> <!-- NEW -->
                    </div>
                    <div id="import-tools-panel" class="drawing-tools hidden">
                        <h3>Import Data</h3>
                        <button id="import-image-btn" class="tool-button"><span>üñºÔ∏è Import Image</span></button>
                        <button id="import-geometry-btn" class="tool-button"><span>üìÑ Import Geometry</span></button>
                    </div>
                </div>
                <div class="map-status">
                    <div id="map-coords">Lat: 0.00, Lng: 0.00</div>
                </div>
            </main>
        </div>
    </div>

    <!-- ===== MODALS ===== -->
    <div id="modals-container">
        <!-- Project Selection List -->
        <div id="project-list-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="project-list-title">Select a Project</h2>
                    <button id="close-project-modal-btn" class="close-button">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="project-list-actions">
                        <button id="new-project-btn" class="button primary full-width">+ New Project</button>
                    </div>
                    <div id="project-list-container" class="project-list"></div>
                </div>
            </div>
        </div>

        <div id="point-radius-group" class="form-group hidden">
            <label for="point-radius">Operation Radius (meters) *</label>
            <input type="number" id="point-radius" name="pointRadius" value="100" min="10" max="1000">
            <small class="form-help">Defines the circular operation area around the point</small>
        </div>

        <!-- Project Editor Form -->
        <div id="project-editor-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="project-editor-title">üìã Create New Project</h2>
                    <button id="close-project-editor-btn" class="close-button" aria-label="Close dialog"></button>
                </div>
                <form id="project-editor-form" class="modal-body">
                    <input type="hidden" id="project-id" name="id">
                    
                    <!-- Basic Information Section -->
                    <div style="border-bottom: 1px solid #e9ecef; padding-bottom: 20px; margin-bottom: 20px;">
                        <h5 style="color: #495057; margin-bottom: 15px; font-size: 1.1rem;">üìù Basic Information</h5>
                        
                        <div class="form-group">
                            <label for="project-title" class="required">Project Title</label>
                            <input type="text" id="project-title" name="title" class="form-control" required 
                                   placeholder="Enter descriptive project title">
                        </div>
                        
                        <div class="form-group">
                            <label for="project-description">Description</label>
                            <textarea id="project-description" name="description" rows="3" class="form-control" 
                                      placeholder="Detailed description of the project objectives and scope..."></textarea>
                        </div>
                    </div>
                    
                    <!-- Schedule & Operations Section -->
                    <div style="border-bottom: 1px solid #e9ecef; padding-bottom: 20px; margin-bottom: 20px;">
                        <h5 style="color: #495057; margin-bottom: 15px; font-size: 1.1rem;">üìÖ Schedule & Operations</h5>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="project-start-date" class="required">Start Date & Time</label>
                                <input type="datetime-local" id="project-start-date" name="startDate" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="project-end-date" class="required">End Date & Time</label>
                                <input type="datetime-local" id="project-end-date" name="endDate" class="form-control" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="project-operation-type">Operation Type</label>
                                <input type="text" id="project-operation-type" name="operationType" class="form-control" 
                                       placeholder="e.g., Aerial Survey, Photography, Inspection">
                            </div>
                            <div class="form-group">
                                <label for="project-priority">Priority Level</label>
                                <select id="project-priority" name="priority" class="form-control">
                                    <option value="Low">üü¢ Low Priority</option>
                                    <option value="Normal" selected>üü° Normal Priority</option>
                                    <option value="High">üü† High Priority</option>
                                    <option value="Critical">üî¥ Critical Priority</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Flight Parameters Section -->
                    <div style="margin-bottom: 20px;">
                        <h5 style="color: #495057; margin-bottom: 15px; font-size: 1.1rem;">‚úàÔ∏è Flight Parameters</h5>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="project-altitude-min">Minimum Altitude (ft AGL)</label>
                                <input type="number" id="project-altitude-min" name="altitudeMin" value="0" 
                                       class="form-control" min="0" max="400" step="10">
                                <small class="form-help">Minimum operating altitude above ground level</small>
                            </div>
                            <div class="form-group">
                                <label for="project-altitude-max">Maximum Altitude (ft AGL)</label>
                                <input type="number" id="project-altitude-max" name="altitudeMax" value="400" 
                                       class="form-control" min="0" max="400" step="10">
                                <small class="form-help">Maximum operating altitude (FAA limit: 400ft)</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" id="cancel-project-editor-btn" class="button secondary">
                            ‚ùå Cancel
                        </button>
                        <button type="submit" class="button primary">
                            üíæ Save Project
                        </button>
                    </div>
                </form>
            </div>
        </div>


        <div id="coordinate-entry-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>üìç Manual Coordinate Entry</h2>
                    <button id="close-coordinate-modal" class="close-button" aria-label="Close dialog"></button>
                </div>
                <div class="modal-body" style="display: grid; grid-template-columns: 1fr 400px; gap: 30px;">
                    <!-- Left side - Form -->
                    <form id="coordinate-entry-form">
                        <div class="form-group">
                            <label for="zone-name" class="required">Zone Name</label>
                            <input type="text" id="zone-name" name="zoneName" class="form-control" required
                                   placeholder="Enter descriptive zone name">
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="geometry-type-selector">Geometry Type</label>
                                <select id="geometry-type-selector" name="geometryType" class="form-control">
                                    <option value="polygon">üî∑ Polygon</option>
                                    <option value="circle">‚≠ï Circle</option>
                                    <option value="point">üìç Point</option>
                                    <option value="multipoint">üìç Multiple Points</option>
                                </select>
                                <small class="form-help">Select the type of geometry to create</small>
                            </div>
                            <div class="form-group">
                                <label for="coordinate-format">Input Format</label>
                                <select id="coordinate-format" name="format" class="form-control">
                                    <option value="decimal">Decimal Degrees (DD)</option>
                                    <option value="dms">Degrees Minutes Seconds (DMS)</option>
                                    <option value="geojson">GeoJSON Array</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="coordinates-input">
                                Coordinates <span style="color: #dc3545;">*</span>
                                <small style="font-weight: normal; color: #6c757d;">Format varies by geometry type selected above</small>
                            </label>
                            <textarea id="coordinates-input" name="coordinates" rows="8" class="form-control"
                                      placeholder="Select geometry type and format above to see example..." required></textarea>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="coord-altitude-min" class="required">Min Altitude (ft AGL)</label>
                                <input type="number" id="coord-altitude-min" name="altitudeMin" value="0" 
                                       min="0" max="400" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="coord-altitude-max" class="required">Max Altitude (ft AGL)</label>
                                <input type="number" id="coord-altitude-max" name="altitudeMax" value="400" 
                                       min="0" max="400" class="form-control" required>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" id="validate-coordinates" class="button success">
                                üîç Validate & Preview
                            </button>
                            <button type="button" id="cancel-coordinate-entry" class="button secondary">
                                Cancel
                            </button>
                            <button type="submit" class="button primary" disabled>
                                Create Zone
                            </button>
                        </div>
                    </form>
                    
                    <!-- Right side - Preview and help -->
                    <div>
                        <!-- Circle Info Panel -->
                        <div id="circle-info-panel" class="form-group circle-only hidden" style="
                            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
                            border: 1px solid #0ea5e9; 
                            border-radius: 8px; 
                            padding: 15px;
                            margin-bottom: 20px;
                        ">
                            <h5 style="color: #0369a1; margin-bottom: 10px;">üìè Circle Input Format</h5>
                            <div style="font-size: 13px; color: #374151;">
                                <p><strong>Decimal:</strong> longitude, latitude, radius_meters</p>
                                <p><strong>DMS:</strong> deg¬∞min'sec"N/S deg¬∞min'sec"E/W radius_meters</p>
                                <p><strong>GeoJSON:</strong> [longitude, latitude, radius_meters]</p>
                                <hr style="margin: 10px 0; border: none; border-top: 1px solid #cbd5e1;">
                                <p style="margin: 0;"><strong>Radius limits:</strong> 1m to 50,000m (50km)</p>
                            </div>
                        </div>
        
                        <!-- Point Options -->
                        <div id="point-options-group" class="form-group hidden">
                            <label for="point-operation-radius">Operation Radius (meters) <span style="color: #dc3545;">*</span></label>
                            <input type="number" id="point-operation-radius" name="pointRadius" value="100" 
                                   min="10" max="1000" class="form-control">
                            <small class="form-help">Defines the circular operation area around each point</small>
                        </div>
                        
                        <!-- Preview Container -->
                        <div id="coordinate-preview-container" class="hidden">
                            <h5>üó∫Ô∏è Preview</h5>
                            <div id="coordinate-preview-map" style="height: 300px; border-radius: 8px; border: 2px solid #d1d5db;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        
        <div id="drone-form-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>üöÅ Create Drone Zone</h2>
                    <button id="close-modal" class="close-button" aria-label="Close dialog"></button>
                </div>
                <form id="drone-zone-form" class="modal-body">
                    <div class="form-group">
                        <label for="operation-id" class="required">Operation ID</label>
                        <input type="text" id="operation-id" name="operationId" class="form-control" required>
                        <div class="form-error" id="operation-id-error"></div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="altitude-min" class="required">Min Altitude (ft AGL)</label>
                            <input type="number" id="altitude-min" name="altitudeMin" value="0" min="0" max="400" class="form-control" required>
                            <div class="form-error" id="altitude-min-error"></div>
                        </div>
                        <div class="form-group">
                            <label for="altitude-max" class="required">Max Altitude (ft AGL)</label>
                            <input type="number" id="altitude-max" name="altitudeMax" value="400" min="0" max="400" class="form-control" required>
                            <div class="form-error" id="altitude-max-error"></div>
                        </div>
                    </div>
        
                    <div class="form-row">
                        <div class="form-group">
                            <label for="start-time" class="required">Start Time</label>
                            <input type="datetime-local" id="start-time" name="startTime" class="form-control" required>
                            <div class="form-error" id="start-time-error"></div>
                        </div>
                        <div class="form-group">
                            <label for="end-time" class="required">End Time</label>
                            <input type="datetime-local" id="end-time" name="endTime" class="form-control" required>
                            <div class="form-error" id="end-time-error"></div>
                        </div>
                    </div>
        
                    <div class="form-group">
                        <label for="status">Status</label>
                        <select id="status" name="status" class="form-control" required>
                            <option value="Planned">üìã Planned</option>
                            <option value="Active">üü¢ Active</option>
                            <option value="Completed">‚úÖ Completed</option>
                        </select>
                        <div class="form-error" id="status-error"></div>
                    </div>
        
                    <div class="form-actions">
                        <button type="button" id="cancel-drone-form" class="button secondary">Cancel</button>
                        <button type="submit" class="button primary">üöÅ Create Drone Zone</button>
                    </div>
                </form>
            </div>
        </div>

        <div id="report-modal" class="modal hidden">
            <div class="modal-content wide">
                <div class="modal-header">
                    <h2 id="report-title">üñ®Ô∏è Preliminary Analysis Report</h2>
                    <button id="close-report-btn" class="close-button">&times;</button>
                </div>
                <div class="modal-body" id="report-body">
                    </div>
                <div class="modal-footer">
                    <button id="print-report-btn" class="button secondary">üñ®Ô∏è Print</button>
                    <button id="export-pdf-btn" class="button primary">üìÑ Export as PDF</button>
                </div>
            </div>
        </div>

        <div id="ocr-processing-modal" class="modal hidden" style="z-index: 10000; backdrop-filter: blur(5px);">
            <div class="ocr-modal-content">
                <div id="ocr-content">
                    <!-- Dynamic content will be inserted here -->
                </div>
            </div>
        </div>

    </div>
    
    <!-- Notification Container -->
    <div id="notification-container"></div>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
    <script src='https://cdn.jsdelivr.net/npm/tesseract.js@2/dist/tesseract.min.js'></script>
    <script type="module" src="js/main.js"></script>
    <script>
        // Screen manager script remains the same
    </script>
    <script>
        // Screen Manager - Add this directly to your HTML
        window.screenManager = {
            currentScreen: null,
            
            showScreen(screenId) {
                console.log(`üñ•Ô∏è Showing screen: ${screenId}`);
                
                // Hide all screens first
                const screens = ['loading-screen', 'login-screen', 'app'];
                screens.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.classList.add('hidden');
                        element.style.display = 'none';
                        console.log(`üëÅÔ∏è Hidden screen: ${id}`);
                    }
                });
                
                // Show the requested screen
                const targetScreen = document.getElementById(screenId);
                if (targetScreen) {
                    targetScreen.classList.remove('hidden');
                    targetScreen.style.display = 'flex';
                    this.currentScreen = screenId;
                    console.log(`‚úÖ Showing screen: ${screenId}`);
                } else {
                    console.error(`‚ùå Screen not found: ${screenId}`);
                }
            },
            
            hideScreen(screenId) {
                console.log(`üôà Hiding screen: ${screenId}`);
                const element = document.getElementById(screenId);
                if (element) {
                    element.classList.add('hidden');
                    element.style.display = 'none';
                }
            },
            
            getCurrentScreen() {
                return this.currentScreen;
            }
        };
        
        // Initialize with loading screen
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üì∫ Screen manager initialized');
            window.screenManager.showScreen('loading-screen');
        });
        </script>
</body>
</html>
